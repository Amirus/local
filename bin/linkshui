#!/usr/bin/env node

var path = require('path');
var util  = require('util');
var argv = require('optimist').argv;
var linkshui = require('../lib/linkshui');

// Help command
// ============
if (argv.h || argv.help) {
    var help = [ // :TODO: help output
        "usage: linkshui [options] ",
        "",
        "Starts a linkshui server using the specified command-line options",
        "",
        "options:",
        "  --port   PORT       Port that the proxy server should run on",
        "  -h, --help          You're staring at it"
    ].join('\n');
    return util.puts(help);
}

// CL config
// =========
var port = argv.port || argv.p || 80;
var config = {
    use_proxy:(argv.proxy ? (+argv.proxy != 0) : false)
};

// Create server
// =============
var server = linkshui.createServer(config);
server.listen(port);
util.puts('linkshui server now listening on port: ' + port);